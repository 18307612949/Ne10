<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Project Ne10: /home/yang01/projects/Ne10/Ne10_doc/Ne10/modules/dsp/NE10_fft_int16.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="ne10_logo.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Project Ne10
   
   </div>
   <div id="projectbrief">An Open Optimized Software Library Project for the ARM Architecture</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">/home/yang01/projects/Ne10/Ne10_doc/Ne10/modules/dsp/NE10_fft_int16.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> *  Copyright 2013-14 ARM Limited</span>
<a name="l00003"></a>00003 <span class="comment"> *  All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> *  Redistribution and use in source and binary forms, with or without</span>
<a name="l00006"></a>00006 <span class="comment"> *  modification, are permitted provided that the following conditions are met:</span>
<a name="l00007"></a>00007 <span class="comment"> *    * Redistributions of source code must retain the above copyright</span>
<a name="l00008"></a>00008 <span class="comment"> *      notice, this list of conditions and the following disclaimer.</span>
<a name="l00009"></a>00009 <span class="comment"> *    * Redistributions in binary form must reproduce the above copyright</span>
<a name="l00010"></a>00010 <span class="comment"> *      notice, this list of conditions and the following disclaimer in the</span>
<a name="l00011"></a>00011 <span class="comment"> *      documentation and/or other materials provided with the distribution.</span>
<a name="l00012"></a>00012 <span class="comment"> *    * Neither the name of ARM Limited nor the</span>
<a name="l00013"></a>00013 <span class="comment"> *      names of its contributors may be used to endorse or promote products</span>
<a name="l00014"></a>00014 <span class="comment"> *      derived from this software without specific prior written permission.</span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> *  THIS SOFTWARE IS PROVIDED BY ARM LIMITED AND CONTRIBUTORS &quot;AS IS&quot; AND</span>
<a name="l00017"></a>00017 <span class="comment"> *  ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED</span>
<a name="l00018"></a>00018 <span class="comment"> *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span>
<a name="l00019"></a>00019 <span class="comment"> *  DISCLAIMED. IN NO EVENT SHALL ARM LIMITED BE LIABLE FOR ANY</span>
<a name="l00020"></a>00020 <span class="comment"> *  DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span>
<a name="l00021"></a>00021 <span class="comment"> *  (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span>
<a name="l00022"></a>00022 <span class="comment"> *  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND</span>
<a name="l00023"></a>00023 <span class="comment"> *  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="l00024"></a>00024 <span class="comment"> *  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span>
<a name="l00025"></a>00025 <span class="comment"> *  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00026"></a>00026 <span class="comment"> */</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="comment">/* license of Kiss FFT */</span>
<a name="l00029"></a>00029 <span class="comment">/*</span>
<a name="l00030"></a>00030 <span class="comment">Copyright (c) 2003-2010, Mark Borgerding</span>
<a name="l00031"></a>00031 <span class="comment"></span>
<a name="l00032"></a>00032 <span class="comment">All rights reserved.</span>
<a name="l00033"></a>00033 <span class="comment"></span>
<a name="l00034"></a>00034 <span class="comment">Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<a name="l00035"></a>00035 <span class="comment"></span>
<a name="l00036"></a>00036 <span class="comment">    * Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<a name="l00037"></a>00037 <span class="comment">    * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
<a name="l00038"></a>00038 <span class="comment">    * Neither the author nor the names of any contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<a name="l00039"></a>00039 <span class="comment"></span>
<a name="l00040"></a>00040 <span class="comment">THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00041"></a>00041 <span class="comment">*/</span>
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 <span class="comment">/*</span>
<a name="l00044"></a>00044 <span class="comment"> * NE10 Library : dsp/NE10_fft_int16.c</span>
<a name="l00045"></a>00045 <span class="comment"> */</span>
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;NE10_types.h&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;NE10_macros.h&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;NE10_fft.h&quot;</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="keyword">static</span> <span class="keywordtype">void</span> ne10_mixed_radix_butterfly_int16_c (<a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a> * Fout,
<a name="l00053"></a>00053         <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a>   * Fin,
<a name="l00054"></a>00054         ne10_int32_t * factors,
<a name="l00055"></a>00055         <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a> * twiddles,
<a name="l00056"></a>00056         <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a> * buffer,
<a name="l00057"></a>00057         ne10_int32_t scaled_flag)
<a name="l00058"></a>00058 {
<a name="l00059"></a>00059     ne10_int32_t fstride, mstride, N;
<a name="l00060"></a>00060     ne10_int32_t fstride1;
<a name="l00061"></a>00061     ne10_int32_t f_count, m_count;
<a name="l00062"></a>00062     ne10_int32_t stage_count;
<a name="l00063"></a>00063 
<a name="l00064"></a>00064     <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a>   scratch_in[8];
<a name="l00065"></a>00065     <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a>   scratch_out[8];
<a name="l00066"></a>00066     <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a>   scratch[16];
<a name="l00067"></a>00067     <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a>   scratch_tw[6];
<a name="l00068"></a>00068 
<a name="l00069"></a>00069     <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a>   *Fin1, *Fin2, *Fout1, *Fout2;
<a name="l00070"></a>00070     <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a>   *Fout_ls = Fout;
<a name="l00071"></a>00071     <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a>   *Ftmp;
<a name="l00072"></a>00072     <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a>   *tw, *tw1, *tw2;
<a name="l00073"></a>00073     <span class="keyword">const</span> ne10_int32_t TW_81 = 23169;
<a name="l00074"></a>00074     <span class="keyword">const</span> ne10_int32_t TW_81N = -23169;
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 
<a name="l00078"></a>00078     <span class="comment">// init fstride, mstride, N</span>
<a name="l00079"></a>00079     stage_count = factors[0];
<a name="l00080"></a>00080     fstride = factors[1];
<a name="l00081"></a>00081     mstride = factors[ (stage_count &lt;&lt; 1) - 1 ];
<a name="l00082"></a>00082     N = factors[ stage_count &lt;&lt; 1 ]; <span class="comment">// radix</span>
<a name="l00083"></a>00083 
<a name="l00084"></a>00084     <span class="comment">// the first stage</span>
<a name="l00085"></a>00085     Fin1 = Fin;
<a name="l00086"></a>00086     Fout1 = Fout;
<a name="l00087"></a>00087     <span class="keywordflow">if</span> (N == 2)   <span class="comment">// length of FFT is 2^n (n is odd)</span>
<a name="l00088"></a>00088     {
<a name="l00089"></a>00089         <span class="comment">// radix 8</span>
<a name="l00090"></a>00090         N = fstride &gt;&gt; 1; <span class="comment">// 1/4 of length of FFT</span>
<a name="l00091"></a>00091         tw = twiddles;
<a name="l00092"></a>00092         fstride1 = fstride &gt;&gt; 2;
<a name="l00093"></a>00093 
<a name="l00094"></a>00094         Fin1 = Fin;
<a name="l00095"></a>00095         <span class="keywordflow">for</span> (f_count = 0; f_count &lt; fstride1; f_count ++)
<a name="l00096"></a>00096         {
<a name="l00097"></a>00097             Fout1 = &amp; Fout[ f_count * 8 ];
<a name="l00098"></a>00098             <span class="comment">// load</span>
<a name="l00099"></a>00099             <span class="keywordflow">if</span> (scaled_flag == 1)
<a name="l00100"></a>00100             {
<a name="l00101"></a>00101                 NE10_F2I16_FIXDIV (Fin1[0], 8);
<a name="l00102"></a>00102                 NE10_F2I16_FIXDIV (Fin1[0 + fstride], 8);
<a name="l00103"></a>00103                 NE10_F2I16_FIXDIV (Fin1[fstride1], 8);
<a name="l00104"></a>00104                 NE10_F2I16_FIXDIV (Fin1[fstride1 + fstride], 8);
<a name="l00105"></a>00105                 NE10_F2I16_FIXDIV (Fin1[fstride1 * 2], 8);
<a name="l00106"></a>00106                 NE10_F2I16_FIXDIV (Fin1[fstride1 * 2 + fstride], 8);
<a name="l00107"></a>00107                 NE10_F2I16_FIXDIV (Fin1[fstride1 * 3], 8);
<a name="l00108"></a>00108                 NE10_F2I16_FIXDIV (Fin1[fstride1 * 3 + fstride], 8);
<a name="l00109"></a>00109             }
<a name="l00110"></a>00110             scratch_in[0].r = Fin1[0].r + Fin1[0 + fstride].r;
<a name="l00111"></a>00111             scratch_in[0].i = Fin1[0].i + Fin1[0 + fstride].i;
<a name="l00112"></a>00112             scratch_in[1].r = Fin1[0].r - Fin1[0 + fstride].r;
<a name="l00113"></a>00113             scratch_in[1].i = Fin1[0].i - Fin1[0 + fstride].i;
<a name="l00114"></a>00114             scratch_in[2].r = Fin1[fstride1].r + Fin1[fstride1 + fstride].r;
<a name="l00115"></a>00115             scratch_in[2].i = Fin1[fstride1].i + Fin1[fstride1 + fstride].i;
<a name="l00116"></a>00116             scratch_in[3].r = Fin1[fstride1].r - Fin1[fstride1 + fstride].r;
<a name="l00117"></a>00117             scratch_in[3].i = Fin1[fstride1].i - Fin1[fstride1 + fstride].i;
<a name="l00118"></a>00118             scratch_in[4].r = Fin1[fstride1 * 2].r + Fin1[fstride1 * 2 + fstride].r;
<a name="l00119"></a>00119             scratch_in[4].i = Fin1[fstride1 * 2].i + Fin1[fstride1 * 2 + fstride].i;
<a name="l00120"></a>00120             scratch_in[5].r = Fin1[fstride1 * 2].r - Fin1[fstride1 * 2 + fstride].r;
<a name="l00121"></a>00121             scratch_in[5].i = Fin1[fstride1 * 2].i - Fin1[fstride1 * 2 + fstride].i;
<a name="l00122"></a>00122             scratch_in[6].r = Fin1[fstride1 * 3].r + Fin1[fstride1 * 3 + fstride].r;
<a name="l00123"></a>00123             scratch_in[6].i = Fin1[fstride1 * 3].i + Fin1[fstride1 * 3 + fstride].i;
<a name="l00124"></a>00124             scratch_in[7].r = Fin1[fstride1 * 3].r - Fin1[fstride1 * 3 + fstride].r;
<a name="l00125"></a>00125             scratch_in[7].i = Fin1[fstride1 * 3].i - Fin1[fstride1 * 3 + fstride].i;
<a name="l00126"></a>00126 
<a name="l00127"></a>00127             <span class="comment">// radix 4 butterfly without twiddles</span>
<a name="l00128"></a>00128             scratch[0] = scratch_in[0];
<a name="l00129"></a>00129             scratch[1] = scratch_in[1];
<a name="l00130"></a>00130 
<a name="l00131"></a>00131             scratch[2] = scratch_in[2];
<a name="l00132"></a>00132             scratch[3].r = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) (scratch_in[3].r + scratch_in[3].i) * TW_81) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l00133"></a>00133             scratch[3].i = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) (scratch_in[3].i - scratch_in[3].r) * TW_81) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l00134"></a>00134 
<a name="l00135"></a>00135             scratch[4] = scratch_in[4];
<a name="l00136"></a>00136             scratch[5].r = scratch_in[5].i;
<a name="l00137"></a>00137             scratch[5].i = -scratch_in[5].r;
<a name="l00138"></a>00138 
<a name="l00139"></a>00139             scratch[6].r = scratch_in[6].r;
<a name="l00140"></a>00140             scratch[6].i = scratch_in[6].i;
<a name="l00141"></a>00141             scratch[7].r = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) (scratch_in[7].r - scratch_in[7].i) * TW_81N) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l00142"></a>00142             scratch[7].i = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) (scratch_in[7].i + scratch_in[7].r) * TW_81N) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l00143"></a>00143 
<a name="l00144"></a>00144             <span class="comment">// radix 2 butterfly</span>
<a name="l00145"></a>00145             scratch[8].r = scratch[0].r + scratch[4].r;
<a name="l00146"></a>00146             scratch[8].i = scratch[0].i + scratch[4].i;
<a name="l00147"></a>00147             scratch[9].r = scratch[1].r + scratch[5].r;
<a name="l00148"></a>00148             scratch[9].i = scratch[1].i + scratch[5].i;
<a name="l00149"></a>00149 
<a name="l00150"></a>00150             scratch[10].r = scratch[0].r - scratch[4].r;
<a name="l00151"></a>00151             scratch[10].i = scratch[0].i - scratch[4].i;
<a name="l00152"></a>00152             scratch[11].r = scratch[1].r - scratch[5].r;
<a name="l00153"></a>00153             scratch[11].i = scratch[1].i - scratch[5].i;
<a name="l00154"></a>00154 
<a name="l00155"></a>00155             <span class="comment">// radix 2 butterfly</span>
<a name="l00156"></a>00156             scratch[12].r = scratch[2].r + scratch[6].r;
<a name="l00157"></a>00157             scratch[12].i = scratch[2].i + scratch[6].i;
<a name="l00158"></a>00158             scratch[13].r = scratch[3].r + scratch[7].r;
<a name="l00159"></a>00159             scratch[13].i = scratch[3].i + scratch[7].i;
<a name="l00160"></a>00160 
<a name="l00161"></a>00161             scratch[14].r = scratch[2].r - scratch[6].r;
<a name="l00162"></a>00162             scratch[14].i = scratch[2].i - scratch[6].i;
<a name="l00163"></a>00163             scratch[15].r = scratch[3].r - scratch[7].r;
<a name="l00164"></a>00164             scratch[15].i = scratch[3].i - scratch[7].i;
<a name="l00165"></a>00165 
<a name="l00166"></a>00166             <span class="comment">// third result</span>
<a name="l00167"></a>00167             scratch_out[4].r = scratch[8].r - scratch[12].r;
<a name="l00168"></a>00168             scratch_out[4].i = scratch[8].i - scratch[12].i;
<a name="l00169"></a>00169             scratch_out[5].r = scratch[9].r - scratch[13].r;
<a name="l00170"></a>00170             scratch_out[5].i = scratch[9].i - scratch[13].i;
<a name="l00171"></a>00171 
<a name="l00172"></a>00172             <span class="comment">// first result</span>
<a name="l00173"></a>00173             scratch_out[0].r = scratch[8].r + scratch[12].r;
<a name="l00174"></a>00174             scratch_out[0].i = scratch[8].i + scratch[12].i;
<a name="l00175"></a>00175             scratch_out[1].r = scratch[9].r + scratch[13].r;
<a name="l00176"></a>00176             scratch_out[1].i = scratch[9].i + scratch[13].i;
<a name="l00177"></a>00177 
<a name="l00178"></a>00178             <span class="comment">// second result</span>
<a name="l00179"></a>00179             scratch_out[2].r = scratch[10].r + scratch[14].i;
<a name="l00180"></a>00180             scratch_out[2].i = scratch[10].i - scratch[14].r;
<a name="l00181"></a>00181             scratch_out[3].r = scratch[11].r + scratch[15].i;
<a name="l00182"></a>00182             scratch_out[3].i = scratch[11].i - scratch[15].r;
<a name="l00183"></a>00183 
<a name="l00184"></a>00184             <span class="comment">// forth result</span>
<a name="l00185"></a>00185             scratch_out[6].r = scratch[10].r - scratch[14].i;
<a name="l00186"></a>00186             scratch_out[6].i = scratch[10].i + scratch[14].r;
<a name="l00187"></a>00187             scratch_out[7].r = scratch[11].r - scratch[15].i;
<a name="l00188"></a>00188             scratch_out[7].i = scratch[11].i + scratch[15].r;
<a name="l00189"></a>00189 
<a name="l00190"></a>00190             <span class="comment">// store</span>
<a name="l00191"></a>00191             Fout1[0] = scratch_out[0];
<a name="l00192"></a>00192             Fout1[1] = scratch_out[1];
<a name="l00193"></a>00193             Fout1[2] = scratch_out[2];
<a name="l00194"></a>00194             Fout1[3] = scratch_out[3];
<a name="l00195"></a>00195             Fout1[4] = scratch_out[4];
<a name="l00196"></a>00196             Fout1[5] = scratch_out[5];
<a name="l00197"></a>00197             Fout1[6] = scratch_out[6];
<a name="l00198"></a>00198             Fout1[7] = scratch_out[7];
<a name="l00199"></a>00199 
<a name="l00200"></a>00200             Fin1 += 1;
<a name="l00201"></a>00201         } <span class="comment">// f_count</span>
<a name="l00202"></a>00202         tw += 6;
<a name="l00203"></a>00203         mstride &lt;&lt;= 2;
<a name="l00204"></a>00204         fstride &gt;&gt;= 4;
<a name="l00205"></a>00205         stage_count -= 2;
<a name="l00206"></a>00206 
<a name="l00207"></a>00207         <span class="comment">// swap</span>
<a name="l00208"></a>00208         Ftmp = buffer;
<a name="l00209"></a>00209         buffer = Fout;
<a name="l00210"></a>00210         Fout = Ftmp;
<a name="l00211"></a>00211     }
<a name="l00212"></a>00212     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (N == 4)   <span class="comment">// length of FFT is 2^n (n is even)</span>
<a name="l00213"></a>00213     {
<a name="l00214"></a>00214         <span class="comment">//fstride is nfft&gt;&gt;2</span>
<a name="l00215"></a>00215         <span class="keywordflow">for</span> (f_count = fstride; f_count ; f_count --)
<a name="l00216"></a>00216         {
<a name="l00217"></a>00217             <span class="comment">// load</span>
<a name="l00218"></a>00218             scratch_in[0] = *Fin1;
<a name="l00219"></a>00219             Fin2 = Fin1 + fstride;
<a name="l00220"></a>00220             scratch_in[1] = *Fin2;
<a name="l00221"></a>00221             Fin2 = Fin2 + fstride;
<a name="l00222"></a>00222             scratch_in[2] = *Fin2;
<a name="l00223"></a>00223             Fin2 = Fin2 + fstride;
<a name="l00224"></a>00224             scratch_in[3] = *Fin2;
<a name="l00225"></a>00225 
<a name="l00226"></a>00226             <span class="comment">// radix 4 butterfly without twiddles</span>
<a name="l00227"></a>00227             <span class="keywordflow">if</span> (scaled_flag == 1)
<a name="l00228"></a>00228             {
<a name="l00229"></a>00229                 NE10_F2I16_FIXDIV (scratch_in[0], 4);
<a name="l00230"></a>00230                 NE10_F2I16_FIXDIV (scratch_in[1], 4);
<a name="l00231"></a>00231                 NE10_F2I16_FIXDIV (scratch_in[2], 4);
<a name="l00232"></a>00232                 NE10_F2I16_FIXDIV (scratch_in[3], 4);
<a name="l00233"></a>00233             }
<a name="l00234"></a>00234 
<a name="l00235"></a>00235             <span class="comment">// radix 2 butterfly</span>
<a name="l00236"></a>00236             scratch[0].r = scratch_in[0].r + scratch_in[2].r;
<a name="l00237"></a>00237             scratch[0].i = scratch_in[0].i + scratch_in[2].i;
<a name="l00238"></a>00238 
<a name="l00239"></a>00239             scratch[1].r = scratch_in[0].r - scratch_in[2].r;
<a name="l00240"></a>00240             scratch[1].i = scratch_in[0].i - scratch_in[2].i;
<a name="l00241"></a>00241 
<a name="l00242"></a>00242             <span class="comment">// radix 2 butterfly</span>
<a name="l00243"></a>00243             scratch[2].r = scratch_in[1].r + scratch_in[3].r;
<a name="l00244"></a>00244             scratch[2].i = scratch_in[1].i + scratch_in[3].i;
<a name="l00245"></a>00245 
<a name="l00246"></a>00246             scratch[3].r = scratch_in[1].r - scratch_in[3].r;
<a name="l00247"></a>00247             scratch[3].i = scratch_in[1].i - scratch_in[3].i;
<a name="l00248"></a>00248 
<a name="l00249"></a>00249             <span class="comment">// third result</span>
<a name="l00250"></a>00250             scratch_out[2].r = scratch[0].r - scratch[2].r;
<a name="l00251"></a>00251             scratch_out[2].i = scratch[0].i - scratch[2].i;
<a name="l00252"></a>00252 
<a name="l00253"></a>00253             <span class="comment">// first result</span>
<a name="l00254"></a>00254             scratch_out[0].r = scratch[0].r + scratch[2].r;
<a name="l00255"></a>00255             scratch_out[0].i = scratch[0].i + scratch[2].i;
<a name="l00256"></a>00256 
<a name="l00257"></a>00257             <span class="comment">// second result</span>
<a name="l00258"></a>00258             scratch_out[1].r = scratch[1].r + scratch[3].i;
<a name="l00259"></a>00259             scratch_out[1].i = scratch[1].i - scratch[3].r;
<a name="l00260"></a>00260 
<a name="l00261"></a>00261             <span class="comment">// forth result</span>
<a name="l00262"></a>00262             scratch_out[3].r = scratch[1].r - scratch[3].i;
<a name="l00263"></a>00263             scratch_out[3].i = scratch[1].i + scratch[3].r;
<a name="l00264"></a>00264 
<a name="l00265"></a>00265             <span class="comment">// store</span>
<a name="l00266"></a>00266             * Fout1 ++ = scratch_out[0];
<a name="l00267"></a>00267             * Fout1 ++ = scratch_out[1];
<a name="l00268"></a>00268             * Fout1 ++ = scratch_out[2];
<a name="l00269"></a>00269             * Fout1 ++ = scratch_out[3];
<a name="l00270"></a>00270 
<a name="l00271"></a>00271             Fin1++;
<a name="l00272"></a>00272         } <span class="comment">// f_count</span>
<a name="l00273"></a>00273 
<a name="l00274"></a>00274         N = fstride; <span class="comment">// 1/4 of length of FFT</span>
<a name="l00275"></a>00275 
<a name="l00276"></a>00276         <span class="comment">// swap</span>
<a name="l00277"></a>00277         Ftmp = buffer;
<a name="l00278"></a>00278         buffer = Fout;
<a name="l00279"></a>00279         Fout = Ftmp;
<a name="l00280"></a>00280 
<a name="l00281"></a>00281         <span class="comment">// update address for other stages</span>
<a name="l00282"></a>00282         stage_count--;
<a name="l00283"></a>00283         tw = twiddles;
<a name="l00284"></a>00284         fstride &gt;&gt;= 2;
<a name="l00285"></a>00285         <span class="comment">// end of first stage</span>
<a name="l00286"></a>00286     }
<a name="l00287"></a>00287 
<a name="l00288"></a>00288 
<a name="l00289"></a>00289     <span class="comment">// others but the last one</span>
<a name="l00290"></a>00290     <span class="keywordflow">for</span> (; stage_count &gt; 1 ; stage_count--)
<a name="l00291"></a>00291     {
<a name="l00292"></a>00292         Fin1 = buffer;
<a name="l00293"></a>00293         <span class="keywordflow">for</span> (f_count = 0; f_count &lt; fstride; f_count ++)
<a name="l00294"></a>00294         {
<a name="l00295"></a>00295             Fout1 = &amp; Fout[ f_count * mstride &lt;&lt; 2 ];
<a name="l00296"></a>00296             tw1 = tw;
<a name="l00297"></a>00297             <span class="keywordflow">for</span> (m_count = mstride; m_count ; m_count --)
<a name="l00298"></a>00298             {
<a name="l00299"></a>00299                 <span class="comment">// load</span>
<a name="l00300"></a>00300                 scratch_tw[0] = *tw1;
<a name="l00301"></a>00301                 tw2 = tw1 + mstride;
<a name="l00302"></a>00302                 scratch_tw[1] = *tw2;
<a name="l00303"></a>00303                 tw2 += mstride;
<a name="l00304"></a>00304                 scratch_tw[2] = *tw2;
<a name="l00305"></a>00305                 scratch_in[0] = * Fin1;
<a name="l00306"></a>00306                 Fin2 = Fin1 + N;
<a name="l00307"></a>00307                 scratch_in[1] = * Fin2;
<a name="l00308"></a>00308                 Fin2 += N;
<a name="l00309"></a>00309                 scratch_in[2] = * Fin2;
<a name="l00310"></a>00310                 Fin2 += N;
<a name="l00311"></a>00311                 scratch_in[3] = * Fin2;
<a name="l00312"></a>00312                 <span class="keywordflow">if</span> (scaled_flag == 1)
<a name="l00313"></a>00313                 {
<a name="l00314"></a>00314                     NE10_F2I16_FIXDIV (scratch_in[0], 4);
<a name="l00315"></a>00315                     NE10_F2I16_FIXDIV (scratch_in[1], 4);
<a name="l00316"></a>00316                     NE10_F2I16_FIXDIV (scratch_in[2], 4);
<a name="l00317"></a>00317                     NE10_F2I16_FIXDIV (scratch_in[3], 4);
<a name="l00318"></a>00318                 }
<a name="l00319"></a>00319 
<a name="l00320"></a>00320                 <span class="comment">// radix 4 butterfly with twiddles</span>
<a name="l00321"></a>00321 
<a name="l00322"></a>00322                 scratch[0] = scratch_in[0];
<a name="l00323"></a>00323                 scratch[1].r = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) scratch_in[1].r * scratch_tw[0].r
<a name="l00324"></a>00324                                                   - (NE10_F2I16_SAMPPROD) scratch_in[1].i * scratch_tw[0].i) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l00325"></a>00325                 scratch[1].i = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) scratch_in[1].i * scratch_tw[0].r
<a name="l00326"></a>00326                                                   + (NE10_F2I16_SAMPPROD) scratch_in[1].r * scratch_tw[0].i) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l00327"></a>00327 
<a name="l00328"></a>00328                 scratch[2].r = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) scratch_in[2].r * scratch_tw[1].r
<a name="l00329"></a>00329                                                   - (NE10_F2I16_SAMPPROD) scratch_in[2].i * scratch_tw[1].i) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l00330"></a>00330                 scratch[2].i = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) scratch_in[2].i * scratch_tw[1].r
<a name="l00331"></a>00331                                                   + (NE10_F2I16_SAMPPROD) scratch_in[2].r * scratch_tw[1].i) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l00332"></a>00332 
<a name="l00333"></a>00333                 scratch[3].r = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) scratch_in[3].r * scratch_tw[2].r
<a name="l00334"></a>00334                                                   - (NE10_F2I16_SAMPPROD) scratch_in[3].i * scratch_tw[2].i) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l00335"></a>00335                 scratch[3].i = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) scratch_in[3].i * scratch_tw[2].r
<a name="l00336"></a>00336                                                   + (NE10_F2I16_SAMPPROD) scratch_in[3].r * scratch_tw[2].i) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l00337"></a>00337 
<a name="l00338"></a>00338                 <span class="comment">// radix 2 butterfly</span>
<a name="l00339"></a>00339                 scratch[4].r = scratch[0].r + scratch[2].r;
<a name="l00340"></a>00340                 scratch[4].i = scratch[0].i + scratch[2].i;
<a name="l00341"></a>00341 
<a name="l00342"></a>00342                 scratch[5].r = scratch[0].r - scratch[2].r;
<a name="l00343"></a>00343                 scratch[5].i = scratch[0].i - scratch[2].i;
<a name="l00344"></a>00344 
<a name="l00345"></a>00345                 <span class="comment">// radix 2 butterfly</span>
<a name="l00346"></a>00346                 scratch[6].r = scratch[1].r + scratch[3].r;
<a name="l00347"></a>00347                 scratch[6].i = scratch[1].i + scratch[3].i;
<a name="l00348"></a>00348 
<a name="l00349"></a>00349                 scratch[7].r = scratch[1].r - scratch[3].r;
<a name="l00350"></a>00350                 scratch[7].i = scratch[1].i - scratch[3].i;
<a name="l00351"></a>00351 
<a name="l00352"></a>00352                 <span class="comment">// third result</span>
<a name="l00353"></a>00353                 scratch_out[2].r = scratch[4].r - scratch[6].r;
<a name="l00354"></a>00354                 scratch_out[2].i = scratch[4].i - scratch[6].i;
<a name="l00355"></a>00355 
<a name="l00356"></a>00356                 <span class="comment">// first result</span>
<a name="l00357"></a>00357                 scratch_out[0].r = scratch[4].r + scratch[6].r;
<a name="l00358"></a>00358                 scratch_out[0].i = scratch[4].i + scratch[6].i;
<a name="l00359"></a>00359 
<a name="l00360"></a>00360                 <span class="comment">// second result</span>
<a name="l00361"></a>00361                 scratch_out[1].r = scratch[5].r + scratch[7].i;
<a name="l00362"></a>00362                 scratch_out[1].i = scratch[5].i - scratch[7].r;
<a name="l00363"></a>00363 
<a name="l00364"></a>00364                 <span class="comment">// forth result</span>
<a name="l00365"></a>00365                 scratch_out[3].r = scratch[5].r - scratch[7].i;
<a name="l00366"></a>00366                 scratch_out[3].i = scratch[5].i + scratch[7].r;
<a name="l00367"></a>00367 
<a name="l00368"></a>00368                 <span class="comment">// store</span>
<a name="l00369"></a>00369                 *Fout1 = scratch_out[0];
<a name="l00370"></a>00370                 Fout2 = Fout1 + mstride;
<a name="l00371"></a>00371                 *Fout2 = scratch_out[1];
<a name="l00372"></a>00372                 Fout2 += mstride;
<a name="l00373"></a>00373                 *Fout2 = scratch_out[2];
<a name="l00374"></a>00374                 Fout2 += mstride;
<a name="l00375"></a>00375                 *Fout2 = scratch_out[3];
<a name="l00376"></a>00376 
<a name="l00377"></a>00377                 tw1++;
<a name="l00378"></a>00378                 Fin1 ++;
<a name="l00379"></a>00379                 Fout1 ++;
<a name="l00380"></a>00380             } <span class="comment">// m_count</span>
<a name="l00381"></a>00381         } <span class="comment">// f_count</span>
<a name="l00382"></a>00382         tw += mstride * 3;
<a name="l00383"></a>00383         mstride &lt;&lt;= 2;
<a name="l00384"></a>00384         <span class="comment">// swap</span>
<a name="l00385"></a>00385         Ftmp = buffer;
<a name="l00386"></a>00386         buffer = Fout;
<a name="l00387"></a>00387         Fout = Ftmp;
<a name="l00388"></a>00388         fstride &gt;&gt;= 2;
<a name="l00389"></a>00389     } <span class="comment">// stage_count</span>
<a name="l00390"></a>00390 
<a name="l00391"></a>00391     <span class="comment">// the last one</span>
<a name="l00392"></a>00392     <span class="keywordflow">if</span> (stage_count)
<a name="l00393"></a>00393     {
<a name="l00394"></a>00394         Fin1 = buffer;
<a name="l00395"></a>00395         <span class="comment">// if stage count is even, output to the input array</span>
<a name="l00396"></a>00396         Fout1 = Fout_ls;
<a name="l00397"></a>00397 
<a name="l00398"></a>00398         <span class="keywordflow">for</span> (f_count = 0; f_count &lt; fstride; f_count ++)
<a name="l00399"></a>00399         {
<a name="l00400"></a>00400             tw1 = tw;
<a name="l00401"></a>00401             <span class="keywordflow">for</span> (m_count = mstride; m_count ; m_count --)
<a name="l00402"></a>00402             {
<a name="l00403"></a>00403                 <span class="comment">// load</span>
<a name="l00404"></a>00404                 scratch_tw[0] = *tw1;
<a name="l00405"></a>00405                 tw2 = tw1 + mstride;
<a name="l00406"></a>00406                 scratch_tw[1] = *tw2;
<a name="l00407"></a>00407                 tw2 += mstride;
<a name="l00408"></a>00408                 scratch_tw[2] = *tw2;
<a name="l00409"></a>00409                 scratch_in[0] = * Fin1;
<a name="l00410"></a>00410                 Fin2 = Fin1 + N;
<a name="l00411"></a>00411                 scratch_in[1] = * Fin2;
<a name="l00412"></a>00412                 Fin2 += N;
<a name="l00413"></a>00413                 scratch_in[2] = * Fin2;
<a name="l00414"></a>00414                 Fin2 += N;
<a name="l00415"></a>00415                 scratch_in[3] = * Fin2;
<a name="l00416"></a>00416                 <span class="keywordflow">if</span> (scaled_flag == 1)
<a name="l00417"></a>00417                 {
<a name="l00418"></a>00418                     NE10_F2I16_FIXDIV (scratch_in[0], 4);
<a name="l00419"></a>00419                     NE10_F2I16_FIXDIV (scratch_in[1], 4);
<a name="l00420"></a>00420                     NE10_F2I16_FIXDIV (scratch_in[2], 4);
<a name="l00421"></a>00421                     NE10_F2I16_FIXDIV (scratch_in[3], 4);
<a name="l00422"></a>00422                 }
<a name="l00423"></a>00423 
<a name="l00424"></a>00424                 <span class="comment">// radix 4 butterfly with twiddles</span>
<a name="l00425"></a>00425 
<a name="l00426"></a>00426                 scratch[0] = scratch_in[0];
<a name="l00427"></a>00427                 scratch[1].r = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) scratch_in[1].r * scratch_tw[0].r
<a name="l00428"></a>00428                                                   - (NE10_F2I16_SAMPPROD) scratch_in[1].i * scratch_tw[0].i) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l00429"></a>00429                 scratch[1].i = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) scratch_in[1].i * scratch_tw[0].r
<a name="l00430"></a>00430                                                   + (NE10_F2I16_SAMPPROD) scratch_in[1].r * scratch_tw[0].i) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l00431"></a>00431 
<a name="l00432"></a>00432                 scratch[2].r = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) scratch_in[2].r * scratch_tw[1].r
<a name="l00433"></a>00433                                                   - (NE10_F2I16_SAMPPROD) scratch_in[2].i * scratch_tw[1].i) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l00434"></a>00434                 scratch[2].i = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) scratch_in[2].i * scratch_tw[1].r
<a name="l00435"></a>00435                                                   + (NE10_F2I16_SAMPPROD) scratch_in[2].r * scratch_tw[1].i) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l00436"></a>00436 
<a name="l00437"></a>00437                 scratch[3].r = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) scratch_in[3].r * scratch_tw[2].r
<a name="l00438"></a>00438                                                   - (NE10_F2I16_SAMPPROD) scratch_in[3].i * scratch_tw[2].i) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l00439"></a>00439                 scratch[3].i = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) scratch_in[3].i * scratch_tw[2].r
<a name="l00440"></a>00440                                                   + (NE10_F2I16_SAMPPROD) scratch_in[3].r * scratch_tw[2].i) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l00441"></a>00441 
<a name="l00442"></a>00442                 <span class="comment">// radix 2 butterfly</span>
<a name="l00443"></a>00443                 scratch[4].r = scratch[0].r + scratch[2].r;
<a name="l00444"></a>00444                 scratch[4].i = scratch[0].i + scratch[2].i;
<a name="l00445"></a>00445 
<a name="l00446"></a>00446                 scratch[5].r = scratch[0].r - scratch[2].r;
<a name="l00447"></a>00447                 scratch[5].i = scratch[0].i - scratch[2].i;
<a name="l00448"></a>00448 
<a name="l00449"></a>00449                 <span class="comment">// radix 2 butterfly</span>
<a name="l00450"></a>00450                 scratch[6].r = scratch[1].r + scratch[3].r;
<a name="l00451"></a>00451                 scratch[6].i = scratch[1].i + scratch[3].i;
<a name="l00452"></a>00452 
<a name="l00453"></a>00453                 scratch[7].r = scratch[1].r - scratch[3].r;
<a name="l00454"></a>00454                 scratch[7].i = scratch[1].i - scratch[3].i;
<a name="l00455"></a>00455 
<a name="l00456"></a>00456                 <span class="comment">// third result</span>
<a name="l00457"></a>00457                 scratch_out[2].r = scratch[4].r - scratch[6].r;
<a name="l00458"></a>00458                 scratch_out[2].i = scratch[4].i - scratch[6].i;
<a name="l00459"></a>00459 
<a name="l00460"></a>00460                 <span class="comment">// first result</span>
<a name="l00461"></a>00461                 scratch_out[0].r = scratch[4].r + scratch[6].r;
<a name="l00462"></a>00462                 scratch_out[0].i = scratch[4].i + scratch[6].i;
<a name="l00463"></a>00463 
<a name="l00464"></a>00464                 <span class="comment">// second result</span>
<a name="l00465"></a>00465                 scratch_out[1].r = scratch[5].r + scratch[7].i;
<a name="l00466"></a>00466                 scratch_out[1].i = scratch[5].i - scratch[7].r;
<a name="l00467"></a>00467 
<a name="l00468"></a>00468                 <span class="comment">// forth result</span>
<a name="l00469"></a>00469                 scratch_out[3].r = scratch[5].r - scratch[7].i;
<a name="l00470"></a>00470                 scratch_out[3].i = scratch[5].i + scratch[7].r;
<a name="l00471"></a>00471 
<a name="l00472"></a>00472                 <span class="comment">// store</span>
<a name="l00473"></a>00473                 *Fout1 = scratch_out[0];
<a name="l00474"></a>00474                 Fout2 = Fout1 + N;
<a name="l00475"></a>00475                 *Fout2 = scratch_out[1];
<a name="l00476"></a>00476                 Fout2 += N;
<a name="l00477"></a>00477                 *Fout2 = scratch_out[2];
<a name="l00478"></a>00478                 Fout2 += N;
<a name="l00479"></a>00479                 *Fout2 = scratch_out[3];
<a name="l00480"></a>00480 
<a name="l00481"></a>00481                 tw1 ++;
<a name="l00482"></a>00482                 Fin1 ++;
<a name="l00483"></a>00483                 Fout1 ++;
<a name="l00484"></a>00484             } <span class="comment">// m_count</span>
<a name="l00485"></a>00485         } <span class="comment">// f_count</span>
<a name="l00486"></a>00486     } <span class="comment">// last stage</span>
<a name="l00487"></a>00487 }
<a name="l00488"></a>00488 
<a name="l00489"></a>00489 <span class="keyword">static</span> <span class="keywordtype">void</span> ne10_mixed_radix_butterfly_inverse_int16_c (<a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a> * Fout,
<a name="l00490"></a>00490         <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a>   * Fin,
<a name="l00491"></a>00491         ne10_int32_t * factors,
<a name="l00492"></a>00492         <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a> * twiddles,
<a name="l00493"></a>00493         <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a> * buffer,
<a name="l00494"></a>00494         ne10_int32_t scaled_flag)
<a name="l00495"></a>00495 {
<a name="l00496"></a>00496     ne10_int32_t fstride, mstride, N;
<a name="l00497"></a>00497     ne10_int32_t fstride1;
<a name="l00498"></a>00498     ne10_int32_t f_count, m_count;
<a name="l00499"></a>00499     ne10_int32_t stage_count;
<a name="l00500"></a>00500 
<a name="l00501"></a>00501     <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a>   scratch_in[8];
<a name="l00502"></a>00502     <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a>   scratch_out[8];
<a name="l00503"></a>00503     <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a>   scratch[16];
<a name="l00504"></a>00504     <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a>   scratch_tw[6];
<a name="l00505"></a>00505 
<a name="l00506"></a>00506     <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a>   *Fin1, *Fin2, *Fout1, *Fout2;
<a name="l00507"></a>00507     <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a>   *Fout_ls = Fout;
<a name="l00508"></a>00508     <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a>   *Ftmp;
<a name="l00509"></a>00509     <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a>   *tw, *tw1, *tw2;
<a name="l00510"></a>00510     <span class="keyword">const</span> ne10_int32_t TW_81 = 23169;
<a name="l00511"></a>00511     <span class="keyword">const</span> ne10_int32_t TW_81N = -23169;
<a name="l00512"></a>00512 
<a name="l00513"></a>00513     <span class="comment">// init fstride, mstride, N</span>
<a name="l00514"></a>00514     stage_count = factors[0];
<a name="l00515"></a>00515     fstride = factors[1];
<a name="l00516"></a>00516     mstride = factors[ (stage_count &lt;&lt; 1) - 1 ];
<a name="l00517"></a>00517     N = factors[ stage_count &lt;&lt; 1 ]; <span class="comment">// radix</span>
<a name="l00518"></a>00518 
<a name="l00519"></a>00519     <span class="comment">// the first stage</span>
<a name="l00520"></a>00520     Fin1 = Fin;
<a name="l00521"></a>00521     Fout1 = Fout;
<a name="l00522"></a>00522     <span class="keywordflow">if</span> (N == 2)   <span class="comment">// length of FFT is 2^n (n is odd)</span>
<a name="l00523"></a>00523     {
<a name="l00524"></a>00524         <span class="comment">// radix 8</span>
<a name="l00525"></a>00525         N = fstride &gt;&gt; 1; <span class="comment">// 1/4 of length of FFT</span>
<a name="l00526"></a>00526         tw = twiddles;
<a name="l00527"></a>00527         fstride1 = fstride &gt;&gt; 2;
<a name="l00528"></a>00528 
<a name="l00529"></a>00529         Fin1 = Fin;
<a name="l00530"></a>00530         <span class="keywordflow">for</span> (f_count = 0; f_count &lt; fstride1; f_count ++)
<a name="l00531"></a>00531         {
<a name="l00532"></a>00532             Fout1 = &amp; Fout[ f_count * 8 ];
<a name="l00533"></a>00533             <span class="comment">// load</span>
<a name="l00534"></a>00534             <span class="keywordflow">if</span> (scaled_flag == 1)
<a name="l00535"></a>00535             {
<a name="l00536"></a>00536                 NE10_F2I16_FIXDIV (Fin1[0], 8);
<a name="l00537"></a>00537                 NE10_F2I16_FIXDIV (Fin1[0 + fstride], 8);
<a name="l00538"></a>00538                 NE10_F2I16_FIXDIV (Fin1[fstride1], 8);
<a name="l00539"></a>00539                 NE10_F2I16_FIXDIV (Fin1[fstride1 + fstride], 8);
<a name="l00540"></a>00540                 NE10_F2I16_FIXDIV (Fin1[fstride1 * 2], 8);
<a name="l00541"></a>00541                 NE10_F2I16_FIXDIV (Fin1[fstride1 * 2 + fstride], 8);
<a name="l00542"></a>00542                 NE10_F2I16_FIXDIV (Fin1[fstride1 * 3], 8);
<a name="l00543"></a>00543                 NE10_F2I16_FIXDIV (Fin1[fstride1 * 3 + fstride], 8);
<a name="l00544"></a>00544             }
<a name="l00545"></a>00545 
<a name="l00546"></a>00546             scratch_in[0].r = Fin1[0].r + Fin1[0 + fstride].r;
<a name="l00547"></a>00547             scratch_in[0].i = Fin1[0].i + Fin1[0 + fstride].i;
<a name="l00548"></a>00548             scratch_in[1].r = Fin1[0].r - Fin1[0 + fstride].r;
<a name="l00549"></a>00549             scratch_in[1].i = Fin1[0].i - Fin1[0 + fstride].i;
<a name="l00550"></a>00550             scratch_in[2].r = Fin1[fstride1].r + Fin1[fstride1 + fstride].r;
<a name="l00551"></a>00551             scratch_in[2].i = Fin1[fstride1].i + Fin1[fstride1 + fstride].i;
<a name="l00552"></a>00552             scratch_in[3].r = Fin1[fstride1].r - Fin1[fstride1 + fstride].r;
<a name="l00553"></a>00553             scratch_in[3].i = Fin1[fstride1].i - Fin1[fstride1 + fstride].i;
<a name="l00554"></a>00554             scratch_in[4].r = Fin1[fstride1 * 2].r + Fin1[fstride1 * 2 + fstride].r;
<a name="l00555"></a>00555             scratch_in[4].i = Fin1[fstride1 * 2].i + Fin1[fstride1 * 2 + fstride].i;
<a name="l00556"></a>00556             scratch_in[5].r = Fin1[fstride1 * 2].r - Fin1[fstride1 * 2 + fstride].r;
<a name="l00557"></a>00557             scratch_in[5].i = Fin1[fstride1 * 2].i - Fin1[fstride1 * 2 + fstride].i;
<a name="l00558"></a>00558             scratch_in[6].r = Fin1[fstride1 * 3].r + Fin1[fstride1 * 3 + fstride].r;
<a name="l00559"></a>00559             scratch_in[6].i = Fin1[fstride1 * 3].i + Fin1[fstride1 * 3 + fstride].i;
<a name="l00560"></a>00560             scratch_in[7].r = Fin1[fstride1 * 3].r - Fin1[fstride1 * 3 + fstride].r;
<a name="l00561"></a>00561             scratch_in[7].i = Fin1[fstride1 * 3].i - Fin1[fstride1 * 3 + fstride].i;
<a name="l00562"></a>00562 
<a name="l00563"></a>00563             <span class="comment">// radix 4 butterfly with twiddles</span>
<a name="l00564"></a>00564 
<a name="l00565"></a>00565             scratch[0] = scratch_in[0];
<a name="l00566"></a>00566             scratch[1] = scratch_in[1];
<a name="l00567"></a>00567 
<a name="l00568"></a>00568             scratch[2] = scratch_in[2];
<a name="l00569"></a>00569             scratch[3].r = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) (scratch_in[3].r - scratch_in[3].i) * TW_81) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l00570"></a>00570             scratch[3].i = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) (scratch_in[3].i + scratch_in[3].r) * TW_81) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l00571"></a>00571 
<a name="l00572"></a>00572             scratch[4] = scratch_in[4];
<a name="l00573"></a>00573             scratch[5].r = -scratch_in[5].i;
<a name="l00574"></a>00574             scratch[5].i = scratch_in[5].r;
<a name="l00575"></a>00575 
<a name="l00576"></a>00576             scratch[6].r = scratch_in[6].r;
<a name="l00577"></a>00577             scratch[6].i = scratch_in[6].i;
<a name="l00578"></a>00578             scratch[7].r = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) (scratch_in[7].r + scratch_in[7].i) * TW_81N) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l00579"></a>00579             scratch[7].i = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) (scratch_in[7].i - scratch_in[7].r) * TW_81N) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l00580"></a>00580 
<a name="l00581"></a>00581             <span class="comment">// radix 2 butterfly</span>
<a name="l00582"></a>00582             scratch[8].r = scratch[0].r + scratch[4].r;
<a name="l00583"></a>00583             scratch[8].i = scratch[0].i + scratch[4].i;
<a name="l00584"></a>00584             scratch[9].r = scratch[1].r + scratch[5].r;
<a name="l00585"></a>00585             scratch[9].i = scratch[1].i + scratch[5].i;
<a name="l00586"></a>00586 
<a name="l00587"></a>00587             scratch[10].r = scratch[0].r - scratch[4].r;
<a name="l00588"></a>00588             scratch[10].i = scratch[0].i - scratch[4].i;
<a name="l00589"></a>00589             scratch[11].r = scratch[1].r - scratch[5].r;
<a name="l00590"></a>00590             scratch[11].i = scratch[1].i - scratch[5].i;
<a name="l00591"></a>00591 
<a name="l00592"></a>00592             <span class="comment">// radix 2 butterfly</span>
<a name="l00593"></a>00593             scratch[12].r = scratch[2].r + scratch[6].r;
<a name="l00594"></a>00594             scratch[12].i = scratch[2].i + scratch[6].i;
<a name="l00595"></a>00595             scratch[13].r = scratch[3].r + scratch[7].r;
<a name="l00596"></a>00596             scratch[13].i = scratch[3].i + scratch[7].i;
<a name="l00597"></a>00597 
<a name="l00598"></a>00598             scratch[14].r = scratch[2].r - scratch[6].r;
<a name="l00599"></a>00599             scratch[14].i = scratch[2].i - scratch[6].i;
<a name="l00600"></a>00600             scratch[15].r = scratch[3].r - scratch[7].r;
<a name="l00601"></a>00601             scratch[15].i = scratch[3].i - scratch[7].i;
<a name="l00602"></a>00602 
<a name="l00603"></a>00603             <span class="comment">// third result</span>
<a name="l00604"></a>00604             scratch_out[4].r = scratch[8].r - scratch[12].r;
<a name="l00605"></a>00605             scratch_out[4].i = scratch[8].i - scratch[12].i;
<a name="l00606"></a>00606             scratch_out[5].r = scratch[9].r - scratch[13].r;
<a name="l00607"></a>00607             scratch_out[5].i = scratch[9].i - scratch[13].i;
<a name="l00608"></a>00608 
<a name="l00609"></a>00609             <span class="comment">// first result</span>
<a name="l00610"></a>00610             scratch_out[0].r = scratch[8].r + scratch[12].r;
<a name="l00611"></a>00611             scratch_out[0].i = scratch[8].i + scratch[12].i;
<a name="l00612"></a>00612             scratch_out[1].r = scratch[9].r + scratch[13].r;
<a name="l00613"></a>00613             scratch_out[1].i = scratch[9].i + scratch[13].i;
<a name="l00614"></a>00614 
<a name="l00615"></a>00615             <span class="comment">// second result</span>
<a name="l00616"></a>00616             scratch_out[2].r = scratch[10].r - scratch[14].i;
<a name="l00617"></a>00617             scratch_out[2].i = scratch[10].i + scratch[14].r;
<a name="l00618"></a>00618             scratch_out[3].r = scratch[11].r - scratch[15].i;
<a name="l00619"></a>00619             scratch_out[3].i = scratch[11].i + scratch[15].r;
<a name="l00620"></a>00620 
<a name="l00621"></a>00621             <span class="comment">// forth result</span>
<a name="l00622"></a>00622             scratch_out[6].r = scratch[10].r + scratch[14].i;
<a name="l00623"></a>00623             scratch_out[6].i = scratch[10].i - scratch[14].r;
<a name="l00624"></a>00624             scratch_out[7].r = scratch[11].r + scratch[15].i;
<a name="l00625"></a>00625             scratch_out[7].i = scratch[11].i - scratch[15].r;
<a name="l00626"></a>00626 
<a name="l00627"></a>00627             <span class="comment">// store</span>
<a name="l00628"></a>00628             Fout1[0] = scratch_out[0];
<a name="l00629"></a>00629             Fout1[1] = scratch_out[1];
<a name="l00630"></a>00630             Fout1[2] = scratch_out[2];
<a name="l00631"></a>00631             Fout1[3] = scratch_out[3];
<a name="l00632"></a>00632             Fout1[4] = scratch_out[4];
<a name="l00633"></a>00633             Fout1[5] = scratch_out[5];
<a name="l00634"></a>00634             Fout1[6] = scratch_out[6];
<a name="l00635"></a>00635             Fout1[7] = scratch_out[7];
<a name="l00636"></a>00636 
<a name="l00637"></a>00637             Fin1 += 1;
<a name="l00638"></a>00638         } <span class="comment">// f_count</span>
<a name="l00639"></a>00639         tw += 6;
<a name="l00640"></a>00640         mstride &lt;&lt;= 2;
<a name="l00641"></a>00641         fstride &gt;&gt;= 4;
<a name="l00642"></a>00642         stage_count -= 2;
<a name="l00643"></a>00643 
<a name="l00644"></a>00644         <span class="comment">// swap</span>
<a name="l00645"></a>00645         Ftmp = buffer;
<a name="l00646"></a>00646         buffer = Fout;
<a name="l00647"></a>00647         Fout = Ftmp;
<a name="l00648"></a>00648     }
<a name="l00649"></a>00649     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (N == 4)   <span class="comment">// length of FFT is 2^n (n is even)</span>
<a name="l00650"></a>00650     {
<a name="l00651"></a>00651         <span class="comment">//fstride is nfft&gt;&gt;2</span>
<a name="l00652"></a>00652         <span class="keywordflow">for</span> (f_count = fstride; f_count ; f_count --)
<a name="l00653"></a>00653         {
<a name="l00654"></a>00654             <span class="comment">// load</span>
<a name="l00655"></a>00655             scratch_in[0] = *Fin1;
<a name="l00656"></a>00656             Fin2 = Fin1 + fstride;
<a name="l00657"></a>00657             scratch_in[1] = *Fin2;
<a name="l00658"></a>00658             Fin2 = Fin2 + fstride;
<a name="l00659"></a>00659             scratch_in[2] = *Fin2;
<a name="l00660"></a>00660             Fin2 = Fin2 + fstride;
<a name="l00661"></a>00661             scratch_in[3] = *Fin2;
<a name="l00662"></a>00662 
<a name="l00663"></a>00663             <span class="comment">// radix 4 butterfly without twiddles</span>
<a name="l00664"></a>00664             <span class="keywordflow">if</span> (scaled_flag == 1)
<a name="l00665"></a>00665             {
<a name="l00666"></a>00666                 NE10_F2I16_FIXDIV (scratch_in[0], 4);
<a name="l00667"></a>00667                 NE10_F2I16_FIXDIV (scratch_in[1], 4);
<a name="l00668"></a>00668                 NE10_F2I16_FIXDIV (scratch_in[2], 4);
<a name="l00669"></a>00669                 NE10_F2I16_FIXDIV (scratch_in[3], 4);
<a name="l00670"></a>00670             }
<a name="l00671"></a>00671 
<a name="l00672"></a>00672             <span class="comment">// radix 2 butterfly</span>
<a name="l00673"></a>00673             scratch[0].r = scratch_in[0].r + scratch_in[2].r;
<a name="l00674"></a>00674             scratch[0].i = scratch_in[0].i + scratch_in[2].i;
<a name="l00675"></a>00675 
<a name="l00676"></a>00676             scratch[1].r = scratch_in[0].r - scratch_in[2].r;
<a name="l00677"></a>00677             scratch[1].i = scratch_in[0].i - scratch_in[2].i;
<a name="l00678"></a>00678 
<a name="l00679"></a>00679             <span class="comment">// radix 2 butterfly</span>
<a name="l00680"></a>00680             scratch[2].r = scratch_in[1].r + scratch_in[3].r;
<a name="l00681"></a>00681             scratch[2].i = scratch_in[1].i + scratch_in[3].i;
<a name="l00682"></a>00682 
<a name="l00683"></a>00683             scratch[3].r = scratch_in[1].r - scratch_in[3].r;
<a name="l00684"></a>00684             scratch[3].i = scratch_in[1].i - scratch_in[3].i;
<a name="l00685"></a>00685 
<a name="l00686"></a>00686             <span class="comment">// third result</span>
<a name="l00687"></a>00687             scratch_out[2].r = scratch[0].r - scratch[2].r;
<a name="l00688"></a>00688             scratch_out[2].i = scratch[0].i - scratch[2].i;
<a name="l00689"></a>00689 
<a name="l00690"></a>00690             <span class="comment">// first result</span>
<a name="l00691"></a>00691             scratch_out[0].r = scratch[0].r + scratch[2].r;
<a name="l00692"></a>00692             scratch_out[0].i = scratch[0].i + scratch[2].i;
<a name="l00693"></a>00693 
<a name="l00694"></a>00694             <span class="comment">// second result</span>
<a name="l00695"></a>00695             scratch_out[1].r = scratch[1].r - scratch[3].i;
<a name="l00696"></a>00696             scratch_out[1].i = scratch[1].i + scratch[3].r;
<a name="l00697"></a>00697 
<a name="l00698"></a>00698             <span class="comment">// forth result</span>
<a name="l00699"></a>00699             scratch_out[3].r = scratch[1].r + scratch[3].i;
<a name="l00700"></a>00700             scratch_out[3].i = scratch[1].i - scratch[3].r;
<a name="l00701"></a>00701 
<a name="l00702"></a>00702             <span class="comment">// store</span>
<a name="l00703"></a>00703             * Fout1 ++ = scratch_out[0];
<a name="l00704"></a>00704             * Fout1 ++ = scratch_out[1];
<a name="l00705"></a>00705             * Fout1 ++ = scratch_out[2];
<a name="l00706"></a>00706             * Fout1 ++ = scratch_out[3];
<a name="l00707"></a>00707 
<a name="l00708"></a>00708             Fin1++;
<a name="l00709"></a>00709         } <span class="comment">// f_count</span>
<a name="l00710"></a>00710 
<a name="l00711"></a>00711         N = fstride; <span class="comment">// 1/4 of length of FFT</span>
<a name="l00712"></a>00712         <span class="comment">// update address for other stages</span>
<a name="l00713"></a>00713         stage_count--;
<a name="l00714"></a>00714         tw = twiddles;
<a name="l00715"></a>00715         fstride &gt;&gt;= 2;
<a name="l00716"></a>00716 
<a name="l00717"></a>00717         <span class="comment">// swap</span>
<a name="l00718"></a>00718         Ftmp = buffer;
<a name="l00719"></a>00719         buffer = Fout;
<a name="l00720"></a>00720         Fout = Ftmp;
<a name="l00721"></a>00721 
<a name="l00722"></a>00722         <span class="comment">// end of first stage</span>
<a name="l00723"></a>00723     }
<a name="l00724"></a>00724 
<a name="l00725"></a>00725 
<a name="l00726"></a>00726     <span class="comment">// others but the last one</span>
<a name="l00727"></a>00727     <span class="keywordflow">for</span> (; stage_count &gt; 1 ; stage_count--)
<a name="l00728"></a>00728     {
<a name="l00729"></a>00729         Fin1 = buffer;
<a name="l00730"></a>00730         <span class="keywordflow">for</span> (f_count = 0; f_count &lt; fstride; f_count ++)
<a name="l00731"></a>00731         {
<a name="l00732"></a>00732             Fout1 = &amp; Fout[ f_count * mstride &lt;&lt; 2 ];
<a name="l00733"></a>00733             tw1 = tw;
<a name="l00734"></a>00734             <span class="keywordflow">for</span> (m_count = mstride; m_count ; m_count --)
<a name="l00735"></a>00735             {
<a name="l00736"></a>00736                 <span class="comment">// load</span>
<a name="l00737"></a>00737                 scratch_tw[0] = *tw1;
<a name="l00738"></a>00738                 tw2 = tw1 + mstride;
<a name="l00739"></a>00739                 scratch_tw[1] = *tw2;
<a name="l00740"></a>00740                 tw2 += mstride;
<a name="l00741"></a>00741                 scratch_tw[2] = *tw2;
<a name="l00742"></a>00742                 scratch_in[0] = * Fin1;
<a name="l00743"></a>00743                 Fin2 = Fin1 + N;
<a name="l00744"></a>00744                 scratch_in[1] = * Fin2;
<a name="l00745"></a>00745                 Fin2 += N;
<a name="l00746"></a>00746                 scratch_in[2] = * Fin2;
<a name="l00747"></a>00747                 Fin2 += N;
<a name="l00748"></a>00748                 scratch_in[3] = * Fin2;
<a name="l00749"></a>00749                 <span class="keywordflow">if</span> (scaled_flag == 1)
<a name="l00750"></a>00750                 {
<a name="l00751"></a>00751                     NE10_F2I16_FIXDIV (scratch_in[0], 4);
<a name="l00752"></a>00752                     NE10_F2I16_FIXDIV (scratch_in[1], 4);
<a name="l00753"></a>00753                     NE10_F2I16_FIXDIV (scratch_in[2], 4);
<a name="l00754"></a>00754                     NE10_F2I16_FIXDIV (scratch_in[3], 4);
<a name="l00755"></a>00755                 }
<a name="l00756"></a>00756 
<a name="l00757"></a>00757                 <span class="comment">// radix 4 butterfly with twiddles</span>
<a name="l00758"></a>00758 
<a name="l00759"></a>00759                 scratch[0] = scratch_in[0];
<a name="l00760"></a>00760                 scratch[1].r = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) scratch_in[1].r * scratch_tw[0].r
<a name="l00761"></a>00761                                                   + (NE10_F2I16_SAMPPROD) scratch_in[1].i * scratch_tw[0].i) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l00762"></a>00762                 scratch[1].i = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) scratch_in[1].i * scratch_tw[0].r
<a name="l00763"></a>00763                                                   - (NE10_F2I16_SAMPPROD) scratch_in[1].r * scratch_tw[0].i) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l00764"></a>00764 
<a name="l00765"></a>00765                 scratch[2].r = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) scratch_in[2].r * scratch_tw[1].r
<a name="l00766"></a>00766                                                   + (NE10_F2I16_SAMPPROD) scratch_in[2].i * scratch_tw[1].i) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l00767"></a>00767                 scratch[2].i = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) scratch_in[2].i * scratch_tw[1].r
<a name="l00768"></a>00768                                                   - (NE10_F2I16_SAMPPROD) scratch_in[2].r * scratch_tw[1].i) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l00769"></a>00769 
<a name="l00770"></a>00770                 scratch[3].r = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) scratch_in[3].r * scratch_tw[2].r
<a name="l00771"></a>00771                                                   + (NE10_F2I16_SAMPPROD) scratch_in[3].i * scratch_tw[2].i) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l00772"></a>00772                 scratch[3].i = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) scratch_in[3].i * scratch_tw[2].r
<a name="l00773"></a>00773                                                   - (NE10_F2I16_SAMPPROD) scratch_in[3].r * scratch_tw[2].i) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l00774"></a>00774 
<a name="l00775"></a>00775                 <span class="comment">// radix 2 butterfly</span>
<a name="l00776"></a>00776                 scratch[4].r = scratch[0].r + scratch[2].r;
<a name="l00777"></a>00777                 scratch[4].i = scratch[0].i + scratch[2].i;
<a name="l00778"></a>00778 
<a name="l00779"></a>00779                 scratch[5].r = scratch[0].r - scratch[2].r;
<a name="l00780"></a>00780                 scratch[5].i = scratch[0].i - scratch[2].i;
<a name="l00781"></a>00781 
<a name="l00782"></a>00782                 <span class="comment">// radix 2 butterfly</span>
<a name="l00783"></a>00783                 scratch[6].r = scratch[1].r + scratch[3].r;
<a name="l00784"></a>00784                 scratch[6].i = scratch[1].i + scratch[3].i;
<a name="l00785"></a>00785 
<a name="l00786"></a>00786                 scratch[7].r = scratch[1].r - scratch[3].r;
<a name="l00787"></a>00787                 scratch[7].i = scratch[1].i - scratch[3].i;
<a name="l00788"></a>00788 
<a name="l00789"></a>00789                 <span class="comment">// third result</span>
<a name="l00790"></a>00790                 scratch_out[2].r = scratch[4].r - scratch[6].r;
<a name="l00791"></a>00791                 scratch_out[2].i = scratch[4].i - scratch[6].i;
<a name="l00792"></a>00792 
<a name="l00793"></a>00793                 <span class="comment">// first result</span>
<a name="l00794"></a>00794                 scratch_out[0].r = scratch[4].r + scratch[6].r;
<a name="l00795"></a>00795                 scratch_out[0].i = scratch[4].i + scratch[6].i;
<a name="l00796"></a>00796 
<a name="l00797"></a>00797                 <span class="comment">// second result</span>
<a name="l00798"></a>00798                 scratch_out[1].r = scratch[5].r - scratch[7].i;
<a name="l00799"></a>00799                 scratch_out[1].i = scratch[5].i + scratch[7].r;
<a name="l00800"></a>00800 
<a name="l00801"></a>00801                 <span class="comment">// forth result</span>
<a name="l00802"></a>00802                 scratch_out[3].r = scratch[5].r + scratch[7].i;
<a name="l00803"></a>00803                 scratch_out[3].i = scratch[5].i - scratch[7].r;
<a name="l00804"></a>00804 
<a name="l00805"></a>00805                 <span class="comment">// store</span>
<a name="l00806"></a>00806                 *Fout1 = scratch_out[0];
<a name="l00807"></a>00807                 Fout2 = Fout1 + mstride;
<a name="l00808"></a>00808                 *Fout2 = scratch_out[1];
<a name="l00809"></a>00809                 Fout2 += mstride;
<a name="l00810"></a>00810                 *Fout2 = scratch_out[2];
<a name="l00811"></a>00811                 Fout2 += mstride;
<a name="l00812"></a>00812                 *Fout2 = scratch_out[3];
<a name="l00813"></a>00813 
<a name="l00814"></a>00814                 tw1++;
<a name="l00815"></a>00815                 Fin1 ++;
<a name="l00816"></a>00816                 Fout1 ++;
<a name="l00817"></a>00817             } <span class="comment">// m_count</span>
<a name="l00818"></a>00818         } <span class="comment">// f_count</span>
<a name="l00819"></a>00819         tw += mstride * 3;
<a name="l00820"></a>00820         mstride &lt;&lt;= 2;
<a name="l00821"></a>00821         <span class="comment">// swap</span>
<a name="l00822"></a>00822         Ftmp = buffer;
<a name="l00823"></a>00823         buffer = Fout;
<a name="l00824"></a>00824         Fout = Ftmp;
<a name="l00825"></a>00825         fstride &gt;&gt;= 2;
<a name="l00826"></a>00826     } <span class="comment">// stage_count</span>
<a name="l00827"></a>00827 
<a name="l00828"></a>00828     <span class="comment">// the last one</span>
<a name="l00829"></a>00829     <span class="keywordflow">if</span> (stage_count)
<a name="l00830"></a>00830     {
<a name="l00831"></a>00831         Fin1 = buffer;
<a name="l00832"></a>00832         <span class="comment">// if stage count is even, output to the input array</span>
<a name="l00833"></a>00833         Fout1 = Fout_ls;
<a name="l00834"></a>00834 
<a name="l00835"></a>00835         <span class="keywordflow">for</span> (f_count = 0; f_count &lt; fstride; f_count ++)
<a name="l00836"></a>00836         {
<a name="l00837"></a>00837             tw1 = tw;
<a name="l00838"></a>00838             <span class="keywordflow">for</span> (m_count = mstride; m_count ; m_count --)
<a name="l00839"></a>00839             {
<a name="l00840"></a>00840                 <span class="comment">// load</span>
<a name="l00841"></a>00841                 scratch_tw[0] = *tw1;
<a name="l00842"></a>00842                 tw2 = tw1 + mstride;
<a name="l00843"></a>00843                 scratch_tw[1] = *tw2;
<a name="l00844"></a>00844                 tw2 += mstride;
<a name="l00845"></a>00845                 scratch_tw[2] = *tw2;
<a name="l00846"></a>00846                 scratch_in[0] = * Fin1;
<a name="l00847"></a>00847                 Fin2 = Fin1 + N;
<a name="l00848"></a>00848                 scratch_in[1] = * Fin2;
<a name="l00849"></a>00849                 Fin2 += N;
<a name="l00850"></a>00850                 scratch_in[2] = * Fin2;
<a name="l00851"></a>00851                 Fin2 += N;
<a name="l00852"></a>00852                 scratch_in[3] = * Fin2;
<a name="l00853"></a>00853                 <span class="keywordflow">if</span> (scaled_flag == 1)
<a name="l00854"></a>00854                 {
<a name="l00855"></a>00855                     NE10_F2I16_FIXDIV (scratch_in[0], 4);
<a name="l00856"></a>00856                     NE10_F2I16_FIXDIV (scratch_in[1], 4);
<a name="l00857"></a>00857                     NE10_F2I16_FIXDIV (scratch_in[2], 4);
<a name="l00858"></a>00858                     NE10_F2I16_FIXDIV (scratch_in[3], 4);
<a name="l00859"></a>00859                 }
<a name="l00860"></a>00860 
<a name="l00861"></a>00861                 <span class="comment">// radix 4 butterfly with twiddles</span>
<a name="l00862"></a>00862 
<a name="l00863"></a>00863                 scratch[0] = scratch_in[0];
<a name="l00864"></a>00864                 scratch[1].r = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) scratch_in[1].r * scratch_tw[0].r
<a name="l00865"></a>00865                                                   + (NE10_F2I16_SAMPPROD) scratch_in[1].i * scratch_tw[0].i) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l00866"></a>00866                 scratch[1].i = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) scratch_in[1].i * scratch_tw[0].r
<a name="l00867"></a>00867                                                   - (NE10_F2I16_SAMPPROD) scratch_in[1].r * scratch_tw[0].i) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l00868"></a>00868 
<a name="l00869"></a>00869                 scratch[2].r = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) scratch_in[2].r * scratch_tw[1].r
<a name="l00870"></a>00870                                                   + (NE10_F2I16_SAMPPROD) scratch_in[2].i * scratch_tw[1].i) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l00871"></a>00871                 scratch[2].i = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) scratch_in[2].i * scratch_tw[1].r
<a name="l00872"></a>00872                                                   - (NE10_F2I16_SAMPPROD) scratch_in[2].r * scratch_tw[1].i) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l00873"></a>00873 
<a name="l00874"></a>00874                 scratch[3].r = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) scratch_in[3].r * scratch_tw[2].r
<a name="l00875"></a>00875                                                   + (NE10_F2I16_SAMPPROD) scratch_in[3].i * scratch_tw[2].i) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l00876"></a>00876                 scratch[3].i = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) scratch_in[3].i * scratch_tw[2].r
<a name="l00877"></a>00877                                                   - (NE10_F2I16_SAMPPROD) scratch_in[3].r * scratch_tw[2].i) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l00878"></a>00878 
<a name="l00879"></a>00879                 <span class="comment">// radix 2 butterfly</span>
<a name="l00880"></a>00880                 scratch[4].r = scratch[0].r + scratch[2].r;
<a name="l00881"></a>00881                 scratch[4].i = scratch[0].i + scratch[2].i;
<a name="l00882"></a>00882 
<a name="l00883"></a>00883                 scratch[5].r = scratch[0].r - scratch[2].r;
<a name="l00884"></a>00884                 scratch[5].i = scratch[0].i - scratch[2].i;
<a name="l00885"></a>00885 
<a name="l00886"></a>00886                 <span class="comment">// radix 2 butterfly</span>
<a name="l00887"></a>00887                 scratch[6].r = scratch[1].r + scratch[3].r;
<a name="l00888"></a>00888                 scratch[6].i = scratch[1].i + scratch[3].i;
<a name="l00889"></a>00889 
<a name="l00890"></a>00890                 scratch[7].r = scratch[1].r - scratch[3].r;
<a name="l00891"></a>00891                 scratch[7].i = scratch[1].i - scratch[3].i;
<a name="l00892"></a>00892 
<a name="l00893"></a>00893                 <span class="comment">// third result</span>
<a name="l00894"></a>00894                 scratch_out[2].r = scratch[4].r - scratch[6].r;
<a name="l00895"></a>00895                 scratch_out[2].i = scratch[4].i - scratch[6].i;
<a name="l00896"></a>00896 
<a name="l00897"></a>00897                 <span class="comment">// first result</span>
<a name="l00898"></a>00898                 scratch_out[0].r = scratch[4].r + scratch[6].r;
<a name="l00899"></a>00899                 scratch_out[0].i = scratch[4].i + scratch[6].i;
<a name="l00900"></a>00900 
<a name="l00901"></a>00901                 <span class="comment">// second result</span>
<a name="l00902"></a>00902                 scratch_out[1].r = scratch[5].r - scratch[7].i;
<a name="l00903"></a>00903                 scratch_out[1].i = scratch[5].i + scratch[7].r;
<a name="l00904"></a>00904 
<a name="l00905"></a>00905                 <span class="comment">// forth result</span>
<a name="l00906"></a>00906                 scratch_out[3].r = scratch[5].r + scratch[7].i;
<a name="l00907"></a>00907                 scratch_out[3].i = scratch[5].i - scratch[7].r;
<a name="l00908"></a>00908 
<a name="l00909"></a>00909                 <span class="comment">// store</span>
<a name="l00910"></a>00910                 *Fout1 = scratch_out[0];
<a name="l00911"></a>00911                 Fout2 = Fout1 + N;
<a name="l00912"></a>00912                 *Fout2 = scratch_out[1];
<a name="l00913"></a>00913                 Fout2 += N;
<a name="l00914"></a>00914                 *Fout2 = scratch_out[2];
<a name="l00915"></a>00915                 Fout2 += N;
<a name="l00916"></a>00916                 *Fout2 = scratch_out[3];
<a name="l00917"></a>00917 
<a name="l00918"></a>00918                 tw1 ++;
<a name="l00919"></a>00919                 Fin1 ++;
<a name="l00920"></a>00920                 Fout1 ++;
<a name="l00921"></a>00921             } <span class="comment">// m_count</span>
<a name="l00922"></a>00922         } <span class="comment">// f_count</span>
<a name="l00923"></a>00923     } <span class="comment">// last stage</span>
<a name="l00924"></a>00924 }
<a name="l00925"></a>00925 
<a name="l00926"></a>00926 
<a name="l00927"></a>00927 <span class="comment">/* factors buffer:</span>
<a name="l00928"></a>00928 <span class="comment"> * 0: stage number</span>
<a name="l00929"></a>00929 <span class="comment"> * 1: stride for the first stage</span>
<a name="l00930"></a>00930 <span class="comment"> * others: factors */</span>
<a name="l00931"></a>00931 <span class="keyword">static</span> ne10_int32_t ne10_factor (ne10_int32_t n, ne10_int32_t * facbuf)
<a name="l00932"></a>00932 {
<a name="l00933"></a>00933     ne10_int32_t p = 4;
<a name="l00934"></a>00934     ne10_int32_t i = 1;
<a name="l00935"></a>00935     ne10_int32_t stage_num = 0;
<a name="l00936"></a>00936     ne10_int32_t stride_max = n;
<a name="l00937"></a>00937 
<a name="l00938"></a>00938     <span class="comment">/* factor out powers of 4, powers of 2 */</span>
<a name="l00939"></a>00939     <span class="keywordflow">do</span>
<a name="l00940"></a>00940     {
<a name="l00941"></a>00941         <span class="keywordflow">if</span> ( (n % p) == 2)
<a name="l00942"></a>00942             p = 2;
<a name="l00943"></a>00943         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (n % p)
<a name="l00944"></a>00944         {
<a name="l00945"></a>00945             <span class="keywordflow">return</span> NE10_ERR;
<a name="l00946"></a>00946         }
<a name="l00947"></a>00947 
<a name="l00948"></a>00948         n /= p;
<a name="l00949"></a>00949         facbuf[2 * i] = p;
<a name="l00950"></a>00950         facbuf[2 * i + 1] = n;
<a name="l00951"></a>00951         i++;
<a name="l00952"></a>00952         stage_num++;
<a name="l00953"></a>00953     }
<a name="l00954"></a>00954     <span class="keywordflow">while</span> (n &gt; 1);
<a name="l00955"></a>00955     facbuf[0] = stage_num;
<a name="l00956"></a>00956     facbuf[1] = stride_max / p;
<a name="l00957"></a>00957     <span class="keywordflow">return</span> NE10_OK;
<a name="l00958"></a>00958 }
<a name="l00959"></a>00959 
<a name="l00960"></a>00960 <span class="keyword">static</span> <span class="keywordtype">void</span> ne10_fft_split_r2c_1d_int16 (<a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a> *dst,
<a name="l00961"></a>00961         <span class="keyword">const</span> <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a> *src,
<a name="l00962"></a>00962         <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a> *twiddles,
<a name="l00963"></a>00963         ne10_int32_t ncfft,
<a name="l00964"></a>00964         ne10_int32_t scaled_flag)
<a name="l00965"></a>00965 {
<a name="l00966"></a>00966     ne10_int32_t k;
<a name="l00967"></a>00967     <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a> fpnk, fpk, f1k, f2k, tw, tdc;
<a name="l00968"></a>00968 
<a name="l00969"></a>00969     tdc.r = src[0].r;
<a name="l00970"></a>00970     tdc.i = src[0].i;
<a name="l00971"></a>00971 
<a name="l00972"></a>00972     <span class="keywordflow">if</span> (scaled_flag)
<a name="l00973"></a>00973         NE10_F2I16_FIXDIV (tdc, 2);
<a name="l00974"></a>00974 
<a name="l00975"></a>00975     dst[0].r = tdc.r + tdc.i;
<a name="l00976"></a>00976     dst[ncfft].r = tdc.r - tdc.i;
<a name="l00977"></a>00977     dst[ncfft].i = dst[0].i = 0;
<a name="l00978"></a>00978 
<a name="l00979"></a>00979     <span class="keywordflow">for</span> (k = 1; k &lt;= ncfft / 2 ; ++k)
<a name="l00980"></a>00980     {
<a name="l00981"></a>00981         fpk    = src[k];
<a name="l00982"></a>00982         fpnk.r =   src[ncfft - k].r;
<a name="l00983"></a>00983         fpnk.i = - src[ncfft - k].i;
<a name="l00984"></a>00984         <span class="keywordflow">if</span> (scaled_flag)
<a name="l00985"></a>00985         {
<a name="l00986"></a>00986             NE10_F2I16_FIXDIV (fpk, 2);
<a name="l00987"></a>00987             NE10_F2I16_FIXDIV (fpnk, 2);
<a name="l00988"></a>00988         }
<a name="l00989"></a>00989 
<a name="l00990"></a>00990         f1k.r = fpk.r + fpnk.r;
<a name="l00991"></a>00991         f1k.i = fpk.i + fpnk.i;
<a name="l00992"></a>00992 
<a name="l00993"></a>00993         f2k.r = fpk.r - fpnk.r;
<a name="l00994"></a>00994         f2k.i = fpk.i - fpnk.i;
<a name="l00995"></a>00995 
<a name="l00996"></a>00996         tw.r = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) f2k.r * (twiddles[k - 1]).r
<a name="l00997"></a>00997                                   - (NE10_F2I16_SAMPPROD) f2k.i * (twiddles[k - 1]).i) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l00998"></a>00998         tw.i = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) f2k.r * (twiddles[k - 1]).i
<a name="l00999"></a>00999                                   + (NE10_F2I16_SAMPPROD) f2k.i * (twiddles[k - 1]).r) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l01000"></a>01000 
<a name="l01001"></a>01001         dst[k].r = (f1k.r + tw.r) &gt;&gt; 1;
<a name="l01002"></a>01002         dst[k].i = (f1k.i + tw.i) &gt;&gt; 1;
<a name="l01003"></a>01003         dst[ncfft - k].r = (f1k.r - tw.r) &gt;&gt; 1;
<a name="l01004"></a>01004         dst[ncfft - k].i = (tw.i - f1k.i) &gt;&gt; 1;
<a name="l01005"></a>01005     }
<a name="l01006"></a>01006 }
<a name="l01007"></a>01007 
<a name="l01008"></a>01008 <span class="keyword">static</span> <span class="keywordtype">void</span> ne10_fft_split_c2r_1d_int16 (<a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a> *dst,
<a name="l01009"></a>01009         <span class="keyword">const</span> <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a> *src,
<a name="l01010"></a>01010         <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a> *twiddles,
<a name="l01011"></a>01011         ne10_int32_t ncfft,
<a name="l01012"></a>01012         ne10_int32_t scaled_flag)
<a name="l01013"></a>01013 {
<a name="l01014"></a>01014 
<a name="l01015"></a>01015     ne10_int32_t k;
<a name="l01016"></a>01016     <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a> fk, fnkc, fek, fok, tmp;
<a name="l01017"></a>01017 
<a name="l01018"></a>01018 
<a name="l01019"></a>01019     dst[0].r = src[0].r + src[ncfft].r;
<a name="l01020"></a>01020     dst[0].i = src[0].r - src[ncfft].r;
<a name="l01021"></a>01021 
<a name="l01022"></a>01022     <span class="keywordflow">if</span> (scaled_flag)
<a name="l01023"></a>01023         NE10_F2I16_FIXDIV (dst[0], 2);
<a name="l01024"></a>01024 
<a name="l01025"></a>01025     <span class="keywordflow">for</span> (k = 1; k &lt;= ncfft / 2; k++)
<a name="l01026"></a>01026     {
<a name="l01027"></a>01027         fk = src[k];
<a name="l01028"></a>01028         fnkc.r = src[ncfft - k].r;
<a name="l01029"></a>01029         fnkc.i = -src[ncfft - k].i;
<a name="l01030"></a>01030         <span class="keywordflow">if</span> (scaled_flag)
<a name="l01031"></a>01031         {
<a name="l01032"></a>01032             NE10_F2I16_FIXDIV (fk, 2);
<a name="l01033"></a>01033             NE10_F2I16_FIXDIV (fnkc, 2);
<a name="l01034"></a>01034         }
<a name="l01035"></a>01035 
<a name="l01036"></a>01036         fek.r = fk.r + fnkc.r;
<a name="l01037"></a>01037         fek.i = fk.i + fnkc.i;
<a name="l01038"></a>01038 
<a name="l01039"></a>01039         tmp.r = fk.r - fnkc.r;
<a name="l01040"></a>01040         tmp.i = fk.i - fnkc.i;
<a name="l01041"></a>01041 
<a name="l01042"></a>01042         fok.r = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) tmp.r * (twiddles[k - 1]).r
<a name="l01043"></a>01043                                    + (NE10_F2I16_SAMPPROD) tmp.i * (twiddles[k - 1]).i) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l01044"></a>01044         fok.i = (ne10_int16_t) ( ( (NE10_F2I16_SAMPPROD) tmp.i * (twiddles[k - 1]).r
<a name="l01045"></a>01045                                    - (NE10_F2I16_SAMPPROD) tmp.r * (twiddles[k - 1]).i) &gt;&gt; NE10_F2I16_SHIFT);
<a name="l01046"></a>01046 
<a name="l01047"></a>01047         dst[k].r = fek.r + fok.r;
<a name="l01048"></a>01048         dst[k].i = fek.i + fok.i;
<a name="l01049"></a>01049 
<a name="l01050"></a>01050         dst[ncfft - k].r = fek.r - fok.r;
<a name="l01051"></a>01051         dst[ncfft - k].i = fok.i - fek.i;
<a name="l01052"></a>01052     }
<a name="l01053"></a>01053 }
<a name="l01054"></a>01054 
<a name="l01066"></a><a class="code" href="group__C2C__FFT__IFFT.html#gaf4cbe44e5e5f6acbdfb767ba9f2749e4">01066</a> <a class="code" href="structne10__fft__state__int16__t.html">ne10_fft_cfg_int16_t</a> <a class="code" href="group__C2C__FFT__IFFT.html#gaf4cbe44e5e5f6acbdfb767ba9f2749e4" title="User-callable function to allocate all necessary storage space for the fft.">ne10_fft_alloc_c2c_int16</a> (ne10_int32_t nfft)
<a name="l01067"></a>01067 {
<a name="l01068"></a>01068     <a class="code" href="structne10__fft__state__int16__t.html">ne10_fft_cfg_int16_t</a> st = NULL;
<a name="l01069"></a>01069     ne10_uint32_t memneeded = <span class="keyword">sizeof</span> (<a class="code" href="structne10__fft__state__int16__t.html">ne10_fft_state_int16_t</a>)
<a name="l01070"></a>01070                               + <span class="keyword">sizeof</span> (ne10_int32_t) * (NE10_MAXFACTORS * 2) <span class="comment">/* factors */</span>
<a name="l01071"></a>01071                               + <span class="keyword">sizeof</span> (<a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a>) * (nfft)        <span class="comment">/* twiddle */</span>
<a name="l01072"></a>01072                               + <span class="keyword">sizeof</span> (<a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a>) * nfft          <span class="comment">/* buffer */</span>
<a name="l01073"></a>01073                               + NE10_FFT_BYTE_ALIGNMENT;     <span class="comment">/* 64-bit alignment*/</span>
<a name="l01074"></a>01074 
<a name="l01075"></a>01075     st = (<a class="code" href="structne10__fft__state__int16__t.html">ne10_fft_cfg_int16_t</a>) NE10_MALLOC (memneeded);
<a name="l01076"></a>01076 
<a name="l01077"></a>01077     <span class="keywordflow">if</span> (st)
<a name="l01078"></a>01078     {
<a name="l01079"></a>01079         uintptr_t address = (uintptr_t) st + <span class="keyword">sizeof</span> (<a class="code" href="structne10__fft__state__int16__t.html">ne10_fft_state_int16_t</a>);
<a name="l01080"></a>01080         NE10_BYTE_ALIGNMENT (address, NE10_FFT_BYTE_ALIGNMENT);
<a name="l01081"></a>01081         st-&gt;factors = (ne10_int32_t*) address;
<a name="l01082"></a>01082         st-&gt;twiddles = (<a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a>*) (st-&gt;factors + (NE10_MAXFACTORS * 2));
<a name="l01083"></a>01083         st-&gt;buffer = st-&gt;twiddles + nfft;
<a name="l01084"></a>01084         st-&gt;nfft = nfft;
<a name="l01085"></a>01085 
<a name="l01086"></a>01086         ne10_int32_t result = ne10_factor (nfft, st-&gt;factors);
<a name="l01087"></a>01087         <span class="keywordflow">if</span> (result == NE10_ERR)
<a name="l01088"></a>01088         {
<a name="l01089"></a>01089             NE10_FREE (st);
<a name="l01090"></a>01090             <span class="keywordflow">return</span> st;
<a name="l01091"></a>01091         }
<a name="l01092"></a>01092 
<a name="l01093"></a>01093         ne10_int32_t i, j;
<a name="l01094"></a>01094         ne10_int32_t *factors = st-&gt;factors;
<a name="l01095"></a>01095         <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a> *twiddles = st-&gt;twiddles;
<a name="l01096"></a>01096         <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a> *tw;
<a name="l01097"></a>01097         ne10_int32_t stage_count = factors[0];
<a name="l01098"></a>01098         ne10_int32_t fstride1 = factors[1];
<a name="l01099"></a>01099         ne10_int32_t fstride2 = fstride1 * 2;
<a name="l01100"></a>01100         ne10_int32_t fstride3 = fstride1 * 3;
<a name="l01101"></a>01101         ne10_int32_t m;
<a name="l01102"></a>01102 
<a name="l01103"></a>01103         <span class="keyword">const</span> ne10_float32_t pi = NE10_PI;
<a name="l01104"></a>01104         ne10_float32_t phase1;
<a name="l01105"></a>01105         ne10_float32_t phase2;
<a name="l01106"></a>01106         ne10_float32_t phase3;
<a name="l01107"></a>01107 
<a name="l01108"></a>01108         <span class="keywordflow">for</span> (i = stage_count - 1; i &gt; 0; i--)
<a name="l01109"></a>01109         {
<a name="l01110"></a>01110             fstride1 &gt;&gt;= 2;
<a name="l01111"></a>01111             fstride2 &gt;&gt;= 2;
<a name="l01112"></a>01112             fstride3 &gt;&gt;= 2;
<a name="l01113"></a>01113             m = factors[2 * i + 1];
<a name="l01114"></a>01114             tw = twiddles;
<a name="l01115"></a>01115             <span class="keywordflow">for</span> (j = 0; j &lt; m; j++)
<a name="l01116"></a>01116             {
<a name="l01117"></a>01117                 phase1 = -2 * pi * fstride1 * j / nfft;
<a name="l01118"></a>01118                 phase2 = -2 * pi * fstride2 * j / nfft;
<a name="l01119"></a>01119                 phase3 = -2 * pi * fstride3 * j / nfft;
<a name="l01120"></a>01120                 tw-&gt;r = (ne10_int16_t) floor (0.5f + NE10_F2I16_MAX * cos (phase1));
<a name="l01121"></a>01121                 tw-&gt;i = (ne10_int16_t) floor (0.5f + NE10_F2I16_MAX * sin (phase1));
<a name="l01122"></a>01122                 (tw + m)-&gt;r = (ne10_int16_t) floor (0.5f + NE10_F2I16_MAX * cos (phase2));
<a name="l01123"></a>01123                 (tw + m)-&gt;i = (ne10_int16_t) floor (0.5f + NE10_F2I16_MAX * sin (phase2));
<a name="l01124"></a>01124                 (tw + m * 2)-&gt;r = (ne10_int16_t) floor (0.5f + NE10_F2I16_MAX * cos (phase3));
<a name="l01125"></a>01125                 (tw + m * 2)-&gt;i = (ne10_int16_t) floor (0.5f + NE10_F2I16_MAX * sin (phase3));
<a name="l01126"></a>01126                 tw++;
<a name="l01127"></a>01127             }
<a name="l01128"></a>01128             twiddles += m * 3;
<a name="l01129"></a>01129         }
<a name="l01130"></a>01130 
<a name="l01131"></a>01131     }
<a name="l01132"></a>01132     <span class="keywordflow">return</span> st;
<a name="l01133"></a>01133 }
<a name="l01134"></a>01134 
<a name="l01146"></a><a class="code" href="group__C2C__FFT__IFFT.html#gab46724c7178fe02e858be576e2ce74b5">01146</a> <span class="keywordtype">void</span> <a class="code" href="group__C2C__FFT__IFFT.html#gab46724c7178fe02e858be576e2ce74b5" title="Mixed radix-2/4 complex FFT/IFFT of 16-bit fixed point data.">ne10_fft_c2c_1d_int16_c</a> (<a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a> *fout,
<a name="l01147"></a>01147                               <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a> *fin,
<a name="l01148"></a>01148                               <a class="code" href="structne10__fft__state__int16__t.html">ne10_fft_cfg_int16_t</a> cfg,
<a name="l01149"></a>01149                               ne10_int32_t inverse_fft,
<a name="l01150"></a>01150                               ne10_int32_t scaled_flag)
<a name="l01151"></a>01151 {
<a name="l01152"></a>01152     <span class="keywordflow">if</span> (inverse_fft)
<a name="l01153"></a>01153         ne10_mixed_radix_butterfly_inverse_int16_c (fout, fin, cfg-&gt;factors, cfg-&gt;twiddles, cfg-&gt;buffer, scaled_flag);
<a name="l01154"></a>01154     <span class="keywordflow">else</span>
<a name="l01155"></a>01155         ne10_mixed_radix_butterfly_int16_c (fout, fin, cfg-&gt;factors, cfg-&gt;twiddles, cfg-&gt;buffer, scaled_flag);
<a name="l01156"></a>01156 }
<a name="l01157"></a>01157 
<a name="l01158"></a>01158 
<a name="l01159"></a>01159 
<a name="l01160"></a>01160  <span class="comment">//end of C2C_FFT_IFFT group</span>
<a name="l01164"></a>01164 
<a name="l01176"></a><a class="code" href="group__R2C__FFT__IFFT.html#ga6531a4db286807154895cf1bbe3aee52">01176</a> <a class="code" href="structne10__fft__r2c__state__int16__t.html">ne10_fft_r2c_cfg_int16_t</a> <a class="code" href="group__R2C__FFT__IFFT.html#ga6531a4db286807154895cf1bbe3aee52" title="User-callable function to allocate all necessary storage space for the fft (r2c/c2r).">ne10_fft_alloc_r2c_int16</a> (ne10_int32_t nfft)
<a name="l01177"></a>01177 {
<a name="l01178"></a>01178     <a class="code" href="structne10__fft__r2c__state__int16__t.html">ne10_fft_r2c_cfg_int16_t</a> st = NULL;
<a name="l01179"></a>01179     ne10_int32_t ncfft = nfft &gt;&gt; 1;
<a name="l01180"></a>01180 
<a name="l01181"></a>01181     ne10_uint32_t memneeded = <span class="keyword">sizeof</span> (<a class="code" href="structne10__fft__r2c__state__int16__t.html">ne10_fft_r2c_state_int16_t</a>)
<a name="l01182"></a>01182                               + <span class="keyword">sizeof</span> (ne10_int32_t) * (NE10_MAXFACTORS * 2) <span class="comment">/* factors */</span>
<a name="l01183"></a>01183                               + <span class="keyword">sizeof</span> (<a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a>) * ncfft         <span class="comment">/* twiddle*/</span>
<a name="l01184"></a>01184                               + <span class="keyword">sizeof</span> (<a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a>) * ncfft / 2     <span class="comment">/* super twiddles*/</span>
<a name="l01185"></a>01185                               + <span class="keyword">sizeof</span> (<a class="code" href="structne10__fft__cpx__int32__t.html" title="structure for the 32 bits fixed point FFT function.">ne10_fft_cpx_int32_t</a>) * nfft          <span class="comment">/* buffer*/</span>
<a name="l01186"></a>01186                               + NE10_FFT_BYTE_ALIGNMENT;     <span class="comment">/* 64-bit alignment*/</span>
<a name="l01187"></a>01187 
<a name="l01188"></a>01188     st = (<a class="code" href="structne10__fft__r2c__state__int16__t.html">ne10_fft_r2c_cfg_int16_t</a>) NE10_MALLOC (memneeded);
<a name="l01189"></a>01189 
<a name="l01190"></a>01190     <span class="keywordflow">if</span> (st)
<a name="l01191"></a>01191     {
<a name="l01192"></a>01192         uintptr_t address = (uintptr_t) st + <span class="keyword">sizeof</span> (<a class="code" href="structne10__fft__r2c__state__int16__t.html">ne10_fft_r2c_state_int16_t</a>);
<a name="l01193"></a>01193         NE10_BYTE_ALIGNMENT (address, NE10_FFT_BYTE_ALIGNMENT);
<a name="l01194"></a>01194         st-&gt;factors = (ne10_int32_t*) address;
<a name="l01195"></a>01195         st-&gt;twiddles = (<a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a>*) (st-&gt;factors + (NE10_MAXFACTORS * 2));
<a name="l01196"></a>01196         st-&gt;super_twiddles = st-&gt;twiddles + ncfft;
<a name="l01197"></a>01197         st-&gt;buffer = st-&gt;super_twiddles + (ncfft / 2);
<a name="l01198"></a>01198         st-&gt;ncfft = ncfft;
<a name="l01199"></a>01199 
<a name="l01200"></a>01200         ne10_int32_t result = ne10_factor (ncfft, st-&gt;factors);
<a name="l01201"></a>01201         <span class="keywordflow">if</span> (result == NE10_ERR)
<a name="l01202"></a>01202         {
<a name="l01203"></a>01203             NE10_FREE (st);
<a name="l01204"></a>01204             <span class="keywordflow">return</span> st;
<a name="l01205"></a>01205         }
<a name="l01206"></a>01206 
<a name="l01207"></a>01207         ne10_int32_t i, j;
<a name="l01208"></a>01208         ne10_int32_t *factors = st-&gt;factors;
<a name="l01209"></a>01209         <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a> *twiddles = st-&gt;twiddles;
<a name="l01210"></a>01210         <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a> *tw;
<a name="l01211"></a>01211         ne10_int32_t stage_count = factors[0];
<a name="l01212"></a>01212         ne10_int32_t fstride1 = factors[1];
<a name="l01213"></a>01213         ne10_int32_t fstride2 = fstride1 * 2;
<a name="l01214"></a>01214         ne10_int32_t fstride3 = fstride1 * 3;
<a name="l01215"></a>01215         ne10_int32_t m;
<a name="l01216"></a>01216 
<a name="l01217"></a>01217         <span class="keyword">const</span> ne10_float32_t pi = NE10_PI;
<a name="l01218"></a>01218         ne10_float32_t phase1;
<a name="l01219"></a>01219         ne10_float32_t phase2;
<a name="l01220"></a>01220         ne10_float32_t phase3;
<a name="l01221"></a>01221 
<a name="l01222"></a>01222         <span class="keywordflow">for</span> (i = stage_count - 1; i &gt; 0; i--)
<a name="l01223"></a>01223         {
<a name="l01224"></a>01224             fstride1 &gt;&gt;= 2;
<a name="l01225"></a>01225             fstride2 &gt;&gt;= 2;
<a name="l01226"></a>01226             fstride3 &gt;&gt;= 2;
<a name="l01227"></a>01227             m = factors[2 * i + 1];
<a name="l01228"></a>01228             tw = twiddles;
<a name="l01229"></a>01229             <span class="keywordflow">for</span> (j = 0; j &lt; m; j++)
<a name="l01230"></a>01230             {
<a name="l01231"></a>01231                 phase1 = -2 * pi * fstride1 * j / ncfft;
<a name="l01232"></a>01232                 phase2 = -2 * pi * fstride2 * j / ncfft;
<a name="l01233"></a>01233                 phase3 = -2 * pi * fstride3 * j / ncfft;
<a name="l01234"></a>01234                 tw-&gt;r = (ne10_int16_t) floor (0.5f + NE10_F2I16_MAX * cos (phase1));
<a name="l01235"></a>01235                 tw-&gt;i = (ne10_int16_t) floor (0.5f + NE10_F2I16_MAX * sin (phase1));
<a name="l01236"></a>01236                 (tw + m)-&gt;r = (ne10_int16_t) floor (0.5f + NE10_F2I16_MAX * cos (phase2));
<a name="l01237"></a>01237                 (tw + m)-&gt;i = (ne10_int16_t) floor (0.5f + NE10_F2I16_MAX * sin (phase2));
<a name="l01238"></a>01238                 (tw + m * 2)-&gt;r = (ne10_int16_t) floor (0.5f + NE10_F2I16_MAX * cos (phase3));
<a name="l01239"></a>01239                 (tw + m * 2)-&gt;i = (ne10_int16_t) floor (0.5f + NE10_F2I16_MAX * sin (phase3));
<a name="l01240"></a>01240                 tw++;
<a name="l01241"></a>01241             }
<a name="l01242"></a>01242             twiddles += m * 3;
<a name="l01243"></a>01243         }
<a name="l01244"></a>01244 
<a name="l01245"></a>01245         tw = st-&gt;super_twiddles;
<a name="l01246"></a>01246         <span class="keywordflow">for</span> (i = 0; i &lt; ncfft / 2; i++)
<a name="l01247"></a>01247         {
<a name="l01248"></a>01248             phase1 = -pi * ( (ne10_float32_t) (i + 1) / ncfft + 0.5f);
<a name="l01249"></a>01249             tw-&gt;r = (ne10_int16_t) floor (0.5f + NE10_F2I16_MAX * cos (phase1));
<a name="l01250"></a>01250             tw-&gt;i = (ne10_int16_t) floor (0.5f + NE10_F2I16_MAX * sin (phase1));
<a name="l01251"></a>01251             tw++;
<a name="l01252"></a>01252         }
<a name="l01253"></a>01253 
<a name="l01254"></a>01254     }
<a name="l01255"></a>01255     <span class="keywordflow">return</span> st;
<a name="l01256"></a>01256 }
<a name="l01257"></a>01257 
<a name="l01269"></a><a class="code" href="group__R2C__FFT__IFFT.html#gab461dec6b7b5ec81cd9e5be4b79bf5d2">01269</a> <span class="keywordtype">void</span> <a class="code" href="group__R2C__FFT__IFFT.html#gab461dec6b7b5ec81cd9e5be4b79bf5d2" title="Mixed radix-2/4 FFT (real to complex) of int16 data.">ne10_fft_r2c_1d_int16_c</a> (<a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a> *fout,
<a name="l01270"></a>01270                               ne10_int16_t *fin,
<a name="l01271"></a>01271                               <a class="code" href="structne10__fft__r2c__state__int16__t.html">ne10_fft_r2c_cfg_int16_t</a> cfg,
<a name="l01272"></a>01272                               ne10_int32_t scaled_flag)
<a name="l01273"></a>01273 {
<a name="l01274"></a>01274     <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a> * tmpbuf = cfg-&gt;buffer;
<a name="l01275"></a>01275 
<a name="l01276"></a>01276     ne10_mixed_radix_butterfly_int16_c (tmpbuf, (<a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a>*) fin, cfg-&gt;factors, cfg-&gt;twiddles, fout, scaled_flag);
<a name="l01277"></a>01277     ne10_fft_split_r2c_1d_int16 (fout, tmpbuf, cfg-&gt;super_twiddles, cfg-&gt;ncfft, scaled_flag);
<a name="l01278"></a>01278 }
<a name="l01279"></a>01279 
<a name="l01291"></a><a class="code" href="group__R2C__FFT__IFFT.html#ga2ca3f2175fd7ef132fbc16457de670d5">01291</a> <span class="keywordtype">void</span> <a class="code" href="group__R2C__FFT__IFFT.html#ga2ca3f2175fd7ef132fbc16457de670d5" title="Mixed radix-2/4 IFFT (complex to real) of int16 data.">ne10_fft_c2r_1d_int16_c</a> (ne10_int16_t *fout,
<a name="l01292"></a>01292                               <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a> *fin,
<a name="l01293"></a>01293                               <a class="code" href="structne10__fft__r2c__state__int16__t.html">ne10_fft_r2c_cfg_int16_t</a> cfg,
<a name="l01294"></a>01294                               ne10_int32_t scaled_flag)
<a name="l01295"></a>01295 {
<a name="l01296"></a>01296     <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a> * tmpbuf1 = cfg-&gt;buffer;
<a name="l01297"></a>01297     <a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a> * tmpbuf2 = cfg-&gt;buffer + cfg-&gt;ncfft;
<a name="l01298"></a>01298 
<a name="l01299"></a>01299     ne10_fft_split_c2r_1d_int16 (tmpbuf1, fin, cfg-&gt;super_twiddles, cfg-&gt;ncfft, scaled_flag);
<a name="l01300"></a>01300     ne10_mixed_radix_butterfly_inverse_int16_c ( (<a class="code" href="structne10__fft__cpx__int16__t.html" title="structure for the 16 bits fixed point FFT function.">ne10_fft_cpx_int16_t</a>*) fout, tmpbuf1, cfg-&gt;factors, cfg-&gt;twiddles, tmpbuf2, scaled_flag);
<a name="l01301"></a>01301 }
<a name="l01302"></a>01302 
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Wed Jul 23 2014 15:12:21 for Project Ne10 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
